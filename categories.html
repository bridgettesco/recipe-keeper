<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipe Categories - My Recipe Keeper</title>
<link href="https://fonts.googleapis.com/css2?family=Indie+Flower&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
    font-family: "Poppins", sans-serif;
    background-color: #fff8f0;
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 800px;
    margin: 0 auto;
}

h1 {
    font-family: "Indie Flower", cursive;
    color: #d85f3c;
    text-align: center;
}

.back-link {
    display: inline-block;
    padding: 8px 15px;
    background: #fff;
    color: #d85f3c;
    text-decoration: none;
    border-radius: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.category-section {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

.category-list {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
}

.category-item {
    background: #fff8e7;
    padding: 8px 15px;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.category-item:hover {
    transform: translateY(-2px);
}

.category-item.active {
    background: #f4a261;
    color: white;
}

.recipe-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}

.recipe-card {
    background: #fff8e7;
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: transform 0.2s;
}

.recipe-card:hover {
    transform: translateY(-3px);
}

.recipe-card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 10px;
}

.recipe-card h3 {
    margin: 0;
    font-family: "Indie Flower", cursive;
    color: #d85f3c;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    padding: 20px;
    box-sizing: border-box;
}

.modal-content {
    background: white;
    padding: 20px;
    border-radius: 15px;
    max-width: 500px;
    margin: 50px auto;
    position: relative;
}

.close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    cursor: pointer;
}

.modal img {
    max-width: 100%;
    border-radius: 10px;
}

button {
    background: #f4a261;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    margin-left: 10px;
}

.empty {
    text-align: center;
    color: #666;
    padding: 30px;
}

@media (max-width: 600px) {
    .recipe-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        margin: 20px;
    }
}
</style>
</head>
<body>
<div class="container">
    <a class="back-link" href="recipekeeperv3.html"> Back to Recipes</a>
    <h1>Browse by Category</h1>
    <div class="category-section">
        <div id="categories" class="category-list"></div>
        <div id="recipesByCategory" class="recipe-grid"></div>
        <p class="empty" id="noData" style="display:none;">No recipes found yet. Add some from the main page.</p>
    </div>
</div>

<div id="recipeModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modalContent"></div>
        <div id="modalButtons" style="text-align:right;margin-top:20px">
            <button onclick="closeModal()" style="background:#999">Close</button>
            <button onclick="editRecipeInModal()">Edit</button>
            <button onclick="deleteRecipe()" style="background:#e76f51">Delete</button>
        </div>
    </div>
</div>

<script>
let currentCategory = null;
let editingRecipe = null;
const categoryColors = ["#f4a261", "#2a9d8f", "#e9c46a", "#e76f51", "#264653", "#8ac926"];

function buildCategories() {
    const recipes = JSON.parse(localStorage.getItem("recipesData")) || [];
    const categoriesEl = document.getElementById("categories");
    const recipesEl = document.getElementById("recipesByCategory");
    const noDataEl = document.getElementById("noData");
    
    if(!recipes.length) {
        noDataEl.style.display = "block";
        categoriesEl.innerHTML = "";
        recipesEl.innerHTML = "";
        return;
    }
    
    noDataEl.style.display = "none";
    
    // Group by categories
    const categories = {};
    recipes.forEach(r => {
        const cat = r.category || "Uncategorized";
        if(!categories[cat]) categories[cat] = [];
        categories[cat].push(r);
    });
    
    // Create category buttons
    categoriesEl.innerHTML = "";
    Object.keys(categories).sort().forEach(cat => {
        const btn = document.createElement("div");
        btn.className = "category-item";
        const colorIndex = cat.charCodeAt(0) % categoryColors.length;
        btn.style.borderLeft = `4px solid ${categoryColors[colorIndex]}`;
        btn.textContent = `${cat} (${categories[cat].length})`;
        btn.onclick = () => {
            document.querySelectorAll(".category-item").forEach(el => el.classList.remove("active"));
            btn.classList.add("active");
            currentCategory = cat;
            showRecipesInCategory(cat, categories[cat]);
        };
        categoriesEl.appendChild(btn);
    });
    
    // Show first category
    if(currentCategory && categories[currentCategory]) {
        const activeBtn = Array.from(categoriesEl.children).find(el => el.textContent.startsWith(currentCategory));
        if(activeBtn) {
            activeBtn.classList.add("active");
            showRecipesInCategory(currentCategory, categories[currentCategory]);
        }
    }
}

function showRecipesInCategory(category, recipes) {
    const recipesEl = document.getElementById("recipesByCategory");
    recipesEl.innerHTML = "";
    
    recipes.forEach((recipe, idx) => {
        const card = document.createElement("div");
        card.className = "recipe-card";
        
        let html = "";
        if(recipe.photo) {
            html += `<img src="${recipe.photo}" alt="${recipe.title}">`;
        }
        html += `<h3>${recipe.title}</h3>`;
        if(recipe.subcategory) {
            html += `<p style="margin:5px 0;color:#666;font-size:0.9em">${recipe.subcategory}</p>`;
        }
        
        card.innerHTML = html;
        card.onclick = () => openRecipeModal(recipe);
        recipesEl.appendChild(card);
    });
}

function openRecipeModal(recipe) {
    editingRecipe = recipe;
    const modal = document.getElementById("recipeModal");
    const content = document.getElementById("modalContent");
    
    let html = "";
    if(recipe.photo) {
        html += `<img src="${recipe.photo}">`;
    }
    html += `
        <h2 style="font-family:'Indie Flower',cursive;color:#d85f3c;margin-top:10px">${recipe.title}</h2>
        <p><strong>Category:</strong> ${recipe.category}${recipe.subcategory ? ` > ${recipe.subcategory}` : ""}</p>
        <p><strong>Ingredients:</strong><br>${recipe.ingredients}</p>
        <p><strong>Instructions:</strong><br>${recipe.instructions}</p>
    `;
    
    content.innerHTML = html;
    modal.style.display = "block";
}

function closeModal() {
    document.getElementById("recipeModal").style.display = "none";
    editingRecipe = null;
}

function editRecipeInModal() {
    if(!editingRecipe) return;
    
    const content = document.getElementById("modalContent");
    content.innerHTML = `
        <h2 style="font-family:'Indie Flower',cursive;color:#d85f3c">Edit Recipe</h2>
        <form id="editForm" style="display:grid;gap:10px">
            <input id="editTitle" value="${editingRecipe.title}" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px" placeholder="Recipe Title">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                <input id="editCategory" value="${editingRecipe.category || ""}" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px" placeholder="Category">
                <input id="editSubcategory" value="${editingRecipe.subcategory || ""}" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px" placeholder="Subcategory">
            </div>
            <textarea id="editIngredients" style="width:100%;height:100px;padding:8px;border:1px solid #ddd;border-radius:8px" placeholder="Ingredients">${editingRecipe.ingredients}</textarea>
            <textarea id="editInstructions" style="width:100%;height:150px;padding:8px;border:1px solid #ddd;border-radius:8px" placeholder="Instructions">${editingRecipe.instructions}</textarea>
            <input type="file" id="editPhoto" accept="image/*">
        </form>
        <div style="text-align:right;margin-top:20px">
            <button onclick="closeModal()" style="background:#999">Cancel</button>
            <button onclick="saveRecipe()">Save Changes</button>
        </div>
    `;
}

function saveRecipe() {
    const form = document.getElementById("editForm");
    const title = document.getElementById("editTitle").value.trim();
    const category = document.getElementById("editCategory").value.trim();
    const subcategory = document.getElementById("editSubcategory").value.trim();
    const ingredients = document.getElementById("editIngredients").value.trim();
    const instructions = document.getElementById("editInstructions").value.trim();
    const photoInput = document.getElementById("editPhoto");
    
    if(!title) {
        alert("Please enter a title");
        return;
    }
    
    if(!category) {
        alert("Please enter a category");
        return;
    }
    
    const recipes = JSON.parse(localStorage.getItem("recipesData")) || [];
    const index = recipes.findIndex(r => r.title === editingRecipe.title && r.category === editingRecipe.category);
    
    if(photoInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = function(e) {
            resizeImage(e.target.result, 800, function(resized) {
                updateRecipe(recipes, index, {title, category, subcategory, ingredients, instructions, photo: resized});
            });
        };
        reader.readAsDataURL(photoInput.files[0]);
    } else {
        updateRecipe(recipes, index, {title, category, subcategory, ingredients, instructions, photo: editingRecipe.photo});
    }
}

function updateRecipe(recipes, index, newData) {
    if(index > -1) {
        recipes[index] = newData;
        localStorage.setItem("recipesData", JSON.stringify(recipes));
        buildCategories();
        closeModal();
    }
}

function deleteRecipe() {
    if(!editingRecipe || !confirm("Are you sure you want to delete this recipe?")) return;
    
    const recipes = JSON.parse(localStorage.getItem("recipesData")) || [];
    const index = recipes.findIndex(r => r.title === editingRecipe.title && r.category === editingRecipe.category);
    
    if(index > -1) {
        recipes.splice(index, 1);
        localStorage.setItem("recipesData", JSON.stringify(recipes));
        buildCategories();
        closeModal();
    }
}

function resizeImage(dataUrl, maxWidth, callback) {
    const img = new Image();
    img.onload = function() {
        const canvas = document.createElement("canvas");
        const scale = Math.min(1, maxWidth / img.width);
        canvas.width = img.width * scale;
        canvas.height = img.height * scale;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        callback(canvas.toDataURL("image/jpeg", 0.8));
    };
    img.src = dataUrl;
}

// Close modal on outside click
window.onclick = function(e) {
    const modal = document.getElementById("recipeModal");
    if(e.target === modal) closeModal();
};

buildCategories();
</script>
</body>
</html>
